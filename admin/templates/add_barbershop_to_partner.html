{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å –±–∞—Ä–±–µ—Ä—à–æ–ø ‚Äî {{ partner.full_name }}{% endblock %}

{% block content %}
<style>
    .search-input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin-bottom: 0.75rem;
    }
    .company-list {
        max-height: 400px;
        overflow-y: auto;
        background: var(--bg-main);
        border-radius: 8px;
        padding: 0.5rem;
    }
    .company-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 0.75rem;
        cursor: pointer;
        border-radius: 6px;
        transition: background 0.2s;
    }
    .company-item:hover {
        background: var(--border);
    }
    .company-item input {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
    }
    .company-city {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-left: 0.5rem;
    }
    .company-id {
        font-size: 0.7rem;
        color: var(--text-muted);
        font-family: monospace;
    }
</style>

<a href="/" class="btn btn-secondary mb-2">&larr; –ù–∞–∑–∞–¥</a>

<h1 class="mb-2">üíà –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ä–±–µ—Ä—à–æ–ø–∞</h1>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">üë§ {{ partner.full_name }}</h2>
    </div>
    
    <div class="partner-info mb-2">
        üì± {{ partner.phone or '‚Äî' }}<br>
        üí¨ @{{ partner.telegram_username or '‚Äî' }} (ID: {{ partner.telegram_id }})
    </div>
    
    {% if partner.branches_text %}
    <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <strong>üìù –ó–∞–ø—Ä–æ—Å –æ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞:</strong>
        <pre style="margin: 0.5rem 0 0 0; white-space: pre-wrap; font-family: inherit;">{{ partner.branches_text }}</pre>
    </div>
    {% endif %}
    
    <form method="post" action="/partners/{{ partner.id }}/add-barbershop">
        <h3 style="margin-bottom: 1rem;">–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ä–±–µ—Ä—à–æ–ø(—ã) –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏:</h3>
        
        {% if companies %}
        <input type="text" id="companySearch" class="search-input" 
               placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –≥–æ—Ä–æ–¥—É...">
        
        <div class="company-list" id="companyList">
            {% for company in companies %}
            <label class="company-item" 
                   data-name="{{ company.name|lower }}" 
                   data-city="{{ (company.city or '')|lower }}">
                <input type="checkbox" name="company_ids" value="{{ company.id }}">
                <span>
                    <strong>{{ company.name }}</strong>
                    {% if company.city %}
                    <span class="company-city">{{ company.city }}</span>
                    {% endif %}
                    <br>
                    <span class="company-id">ID: {{ company.yclients_id }}</span>
                </span>
            </label>
            {% endfor %}
        </div>
        
        <div class="text-muted mt-1" style="font-size: 0.85rem;">
            –í—Å–µ–≥–æ –±–∞—Ä–±–µ—Ä—à–æ–ø–æ–≤: {{ companies|length }}
            | <a href="/yclients-companies/sync" style="color: var(--accent);">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</a>
        </div>
        
        <div class="flex mt-2" style="gap: 1rem;">
            <button type="submit" class="btn btn-success">‚úÖ –ü—Ä–∏–≤—è–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
            <a href="/" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
        {% else %}
        <div class="alert" style="background: var(--warning-light); border: 1px solid var(--warning); padding: 1rem; border-radius: 8px;">
            ‚ö†Ô∏è –ë–∞—Ä–±–µ—Ä—à–æ–ø—ã –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. 
            <a href="/yclients-companies" style="color: var(--accent);">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑ YClients</a>
        </div>
        {% endif %}
    </form>
</div>

<script>
// –ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É –±–∞—Ä–±–µ—Ä—à–æ–ø–æ–≤
document.getElementById('companySearch')?.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    const items = document.querySelectorAll('.company-item');
    
    items.forEach(item => {
        const name = item.dataset.name || '';
        const city = item.dataset.city || '';
        const matches = name.includes(query) || city.includes(query);
        item.style.display = matches ? '' : 'none';
    });
});
</script>
{% endblock %}

