{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ{% endblock %}

{% block content %}
<div class="page-header">
    <a href="/polls" class="btn btn-secondary">&larr; –ù–∞–∑–∞–¥</a>
    <h1>üó≥ –ù–æ–≤–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h1>
</div>

<div class="form-container">
    <form action="/polls/create" method="post" id="pollForm">
        <div class="form-group">
            <label for="question">–í–æ–ø—Ä–æ—Å</label>
            <input type="text" id="question" name="question" 
                   placeholder="–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –≤–∞—Å —É–¥–æ–±–Ω–µ–µ?" 
                   required maxlength="255">
            <small>–ú–∞–∫—Å–∏–º—É–º 255 —Å–∏–º–≤–æ–ª–æ–≤</small>
        </div>
        
        <div class="form-group">
            <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</label>
            <div id="optionsContainer">
                <div class="option-row">
                    <input type="text" class="option-input" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1" maxlength="100">
                    <button type="button" class="btn-remove" onclick="removeOption(this)" style="display:none;">‚úï</button>
                </div>
                <div class="option-row">
                    <input type="text" class="option-input" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 2" maxlength="100">
                    <button type="button" class="btn-remove" onclick="removeOption(this)" style="display:none;">‚úï</button>
                </div>
            </div>
            <button type="button" class="btn btn-secondary btn-add-option" onclick="addOption()">
                + –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
            </button>
            <small>–ú–∏–Ω–∏–º—É–º 2, –º–∞–∫—Å–∏–º—É–º 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</small>
            <input type="hidden" id="options" name="options">
        </div>
        
        <div class="form-group">
            <label>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</label>
            <div class="checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="allows_multiple" value="1">
                    <span>‚òëÔ∏è –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</span>
                </label>
            </div>
            <small class="info-text">‚ÑπÔ∏è –í—Å–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–¥–Ω—ã –≤ –∞–¥–º–∏–Ω–∫–µ</small>
        </div>
        
        <div class="form-actions">
            <a href="/polls" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫</button>
        </div>
    </form>
</div>

<style>
.page-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

.page-header h1 {
    margin: 0;
}

.form-container {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    max-width: 600px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.form-group input[type="text"] {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
}

.form-group input[type="text"]:focus {
    border-color: #4a90a4;
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.1);
}

.form-group small {
    display: block;
    color: #888;
    font-size: 0.85rem;
    margin-top: 0.25rem;
}

#optionsContainer {
    margin-bottom: 0.5rem;
}

.option-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.option-input {
    flex: 1;
}

.btn-remove {
    background: #ff6b6b;
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 1rem;
}

.btn-remove:hover {
    background: #ee5a5a;
}

.btn-add-option {
    width: 100%;
    margin-bottom: 0.5rem;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    cursor: pointer;
}

.checkbox-label input {
    margin-top: 0.25rem;
}

.checkbox-label span {
    font-weight: 500;
}

.checkbox-label small {
    display: block;
    color: #888;
    font-size: 0.8rem;
    margin-top: 0.15rem;
    margin-left: 0;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
}
</style>

<script>
let optionCount = 2;

function addOption() {
    if (optionCount >= 10) {
        alert('–ú–∞–∫—Å–∏–º—É–º 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤');
        return;
    }
    
    optionCount++;
    const container = document.getElementById('optionsContainer');
    const row = document.createElement('div');
    row.className = 'option-row';
    row.innerHTML = `
        <input type="text" class="option-input" placeholder="–í–∞—Ä–∏–∞–Ω—Ç ${optionCount}" maxlength="100">
        <button type="button" class="btn-remove" onclick="removeOption(this)">‚úï</button>
    `;
    container.appendChild(row);
    updateRemoveButtons();
}

function removeOption(btn) {
    if (optionCount <= 2) {
        alert('–ú–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞');
        return;
    }
    
    btn.parentElement.remove();
    optionCount--;
    updatePlaceholders();
    updateRemoveButtons();
}

function updatePlaceholders() {
    const inputs = document.querySelectorAll('.option-input');
    inputs.forEach((input, i) => {
        input.placeholder = `–í–∞—Ä–∏–∞–Ω—Ç ${i + 1}`;
    });
}

function updateRemoveButtons() {
    const buttons = document.querySelectorAll('.btn-remove');
    buttons.forEach(btn => {
        btn.style.display = optionCount > 2 ? 'block' : 'none';
    });
}

document.getElementById('pollForm').addEventListener('submit', function(e) {
    const inputs = document.querySelectorAll('.option-input');
    const options = [];
    
    inputs.forEach(input => {
        const value = input.value.trim();
        if (value) {
            options.push(value);
        }
    });
    
    if (options.length < 2) {
        e.preventDefault();
        alert('–î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞');
        return;
    }
    
    document.getElementById('options').value = options.join('\n');
});
</script>
{% endblock %}

