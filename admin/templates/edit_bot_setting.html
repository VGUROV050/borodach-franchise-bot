{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî Borodach Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
    <a href="/bot-settings" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</div>

<div class="card">
    <form method="post" action="/bot-settings/{{ setting.key }}/edit">
        <div style="padding: 1.5rem; display: grid; gap: 1.5rem;">
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ -->
            <div class="setting-info">
                <div class="setting-key">{{ setting.key }}</div>
                {% if setting.description %}
                <div class="setting-description">{{ setting.description }}</div>
                {% endif %}
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç—É–ª–±–∞—Ä–æ–º -->
            <div>
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                
                <!-- Toolbar -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                    <button type="button" onclick="wrapText('b')" class="format-btn" title="–ñ–∏—Ä–Ω—ã–π">
                        <b>B</b>
                    </button>
                    <button type="button" onclick="wrapText('i')" class="format-btn" title="–ö—É—Ä—Å–∏–≤">
                        <i>I</i>
                    </button>
                    <button type="button" onclick="wrapText('u')" class="format-btn" title="–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π">
                        <u>U</u>
                    </button>
                    <button type="button" onclick="wrapText('s')" class="format-btn" title="–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π">
                        <s>S</s>
                    </button>
                    <button type="button" onclick="wrapText('code')" class="format-btn" title="–ö–æ–¥">
                        &lt;/&gt;
                    </button>
                    <button type="button" onclick="insertLink()" class="format-btn" title="–°—Å—ã–ª–∫–∞">
                        üîó
                    </button>
                    <button type="button" onclick="insertNewline()" class="format-btn" title="–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞">
                        ‚Üµ
                    </button>
                </div>
                
                <textarea id="message_text" name="value" required
                          rows="10" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; font-family: monospace; resize: vertical;">{{ setting.value }}</textarea>
                
                <small style="color: var(--text-muted);">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML: &lt;b&gt;, &lt;i&gt;, &lt;u&gt;, &lt;s&gt;, &lt;code&gt;, &lt;a href=""&gt;</small>
            </div>
            
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div>
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ Telegram</label>
                <div id="preview" style="background: #e5ddd5; padding: 1rem; border-radius: 12px; min-height: 60px;">
                    <div style="background: #dcf8c6; padding: 0.75rem 1rem; border-radius: 8px; max-width: 400px; word-wrap: break-word; box-shadow: 0 1px 1px rgba(0,0,0,0.1);">
                        <div id="preview-content" style="white-space: pre-wrap; line-height: 1.5;"></div>
                    </div>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div style="display: flex; gap: 1rem; justify-content: flex-end; border-top: 1px solid var(--border); padding-top: 1.5rem;">
                <a href="/bot-settings" class="btn" style="background: var(--card-bg); border: 1px solid var(--border);">
                    –û—Ç–º–µ–Ω–∞
                </a>
                <button type="submit" class="btn btn-success">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </form>
</div>

<style>
.setting-info {
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
}

.setting-key {
    font-family: monospace;
    font-size: 0.9rem;
    color: var(--accent);
    background: var(--accent-light);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 0.5rem;
}

.setting-description {
    color: var(--text-muted);
    font-size: 0.875rem;
}

.format-btn {
    padding: 0.5rem 0.75rem;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.875rem;
    min-width: 36px;
    transition: all 0.2s;
}

.format-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
</style>

<script>
const textarea = document.getElementById('message_text');
const preview = document.getElementById('preview-content');

function updatePreview() {
    let text = textarea.value;
    preview.innerHTML = text || '<span style="color: #999;">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...</span>';
}

textarea.addEventListener('input', updatePreview);
updatePreview();

function wrapText(tag) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    const replacement = `<${tag}>${selectedText}</${tag}>`;
    
    textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
    textarea.focus();
    textarea.setSelectionRange(start + tag.length + 2, start + tag.length + 2 + selectedText.length);
    updatePreview();
}

function insertLink() {
    const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://t.me/username):');
    if (!url) return;
    
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end) || '—Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏';
    const replacement = `<a href="${url}">${selectedText}</a>`;
    
    textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
    textarea.focus();
    updatePreview();
}

function insertNewline() {
    const start = textarea.selectionStart;
    textarea.value = textarea.value.substring(0, start) + '\n' + textarea.value.substring(start);
    textarea.focus();
    textarea.setSelectionRange(start + 1, start + 1);
    updatePreview();
}
</script>
{% endblock %}
