{% extends "base.html" %}

{% block title %}–ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Å–µ—Ç–∏ ‚Äî Borodach Admin{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>üó∫ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Å–µ—Ç–∏</h1>
</div>

<!-- –ú–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∏ vs –æ—Å—Ç–∞–ª—å–Ω—ã–µ -->
<div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card">
        <div class="stat-value">{{ geo.total_salons }}</div>
        <div class="stat-label">–í—Å–µ–≥–æ —Å–∞–ª–æ–Ω–æ–≤</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--accent);">{{ geo.millionniki_count }}</div>
        <div class="stat-label">–í –º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∞—Ö ({{ geo.millionniki_percent }}%)</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--warning);">{{ geo.other_count }}</div>
        <div class="stat-label">–í –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö ({{ geo.other_percent }}%)</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--success);">{{ geo.by_city|length }}</div>
        <div class="stat-label">–ì–æ—Ä–æ–¥–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
    <!-- –ü–æ —Ä–µ–≥–∏–æ–Ω–∞–º -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üìç –ü–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–≥–∞–º</div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>–†–µ–≥–∏–æ–Ω</th>
                    <th style="text-align: right;">–°–∞–ª–æ–Ω–æ–≤</th>
                    <th style="text-align: right;">–í—ã—Ä—É—á–∫–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for region, data in geo.by_region.items() %}
                <tr>
                    <td style="font-weight: 500;">{{ region }}</td>
                    <td style="text-align: right;">
                        <span class="badge badge-verified">{{ data.count }}</span>
                    </td>
                    <td style="text-align: right; color: var(--success); font-weight: 500;">
                        {{ "{:,.0f}".format(data.revenue).replace(",", " ") }} ‚ÇΩ
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- –ü–æ –≥–æ—Ä–æ–¥–∞–º -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üèô –ü–æ –≥–æ—Ä–æ–¥–∞–º (—Ç–æ–ø-20)</div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>–ì–æ—Ä–æ–¥</th>
                    <th style="text-align: right;">–°–∞–ª–æ–Ω–æ–≤</th>
                    <th style="text-align: right;">–í—ã—Ä—É—á–∫–∞</th>
                    <th style="text-align: right;">–°—Ä. —á–µ–∫</th>
                </tr>
            </thead>
            <tbody>
                {% for city, data in (geo.by_city.items() | list)[:20] %}
                <tr>
                    <td>
                        <span style="font-weight: 500;">{{ city }}</span>
                        {% if city.lower() in ['–º–æ—Å–∫–≤–∞', '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥', '—Å–ø–±', '–∫–∞–∑–∞–Ω—å', '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥', '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '—á–µ–ª—è–±–∏–Ω—Å–∫', '—Å–∞–º–∞—Ä–∞', '—É—Ñ–∞', '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É', '–æ–º—Å–∫', '–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä', '–≤–æ—Ä–æ–Ω–µ–∂', '–ø–µ—Ä–º—å', '–≤–æ–ª–≥–æ–≥—Ä–∞–¥'] %}
                        <span style="font-size: 0.75rem; color: var(--accent);">‚òÖ –º–ª–Ω</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <span class="badge badge-verified">{{ data.count }}</span>
                    </td>
                    <td style="text-align: right; color: var(--success); font-weight: 500;">
                        {{ "{:,.0f}".format(data.revenue).replace(",", " ") }} ‚ÇΩ
                    </td>
                    <td style="text-align: right; color: var(--text-muted);">
                        {{ "{:,.0f}".format(data.avg_check).replace(",", " ") }} ‚ÇΩ
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if geo.by_city|length > 20 %}
        <div style="padding: 1rem; text-align: center; color: var(--text-muted); font-size: 0.875rem;">
            ... –∏ –µ—â—ë {{ geo.by_city|length - 20 }} –≥–æ—Ä–æ–¥–æ–≤
        </div>
        {% endif %}
    </div>
</div>

<!-- –í—ã—Ä—É—á–∫–∞: –º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∏ vs –æ—Å—Ç–∞–ª—å–Ω—ã–µ -->
<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <div class="card-title">üí∞ –í—ã—Ä—É—á–∫–∞: –º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∏ vs –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞</div>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 1rem;">
        <div style="text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: var(--accent);">
                {{ "{:,.0f}".format(geo.millionniki_revenue).replace(",", " ") }} ‚ÇΩ
            </div>
            <div style="color: var(--text-muted); margin-top: 0.5rem;">
                –í—ã—Ä—É—á–∫–∞ –≤ –º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∞—Ö
                {% if geo.millionniki_revenue + geo.other_revenue > 0 %}
                ({{ "%.1f"|format(geo.millionniki_revenue / (geo.millionniki_revenue + geo.other_revenue) * 100) }}%)
                {% endif %}
            </div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 2rem; font-weight: 700; color: var(--warning);">
                {{ "{:,.0f}".format(geo.other_revenue).replace(",", " ") }} ‚ÇΩ
            </div>
            <div style="color: var(--text-muted); margin-top: 0.5rem;">
                –í—ã—Ä—É—á–∫–∞ –≤ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö
                {% if geo.millionniki_revenue + geo.other_revenue > 0 %}
                ({{ "%.1f"|format(geo.other_revenue / (geo.millionniki_revenue + geo.other_revenue) * 100) }}%)
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if geo.unknown_cities %}
<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <div class="card-title">‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–æ—Ä–æ–¥ ({{ geo.unknown_cities|length }})</div>
    </div>
    <div style="padding: 1rem; color: var(--text-muted); font-size: 0.875rem;">
        {% for name in geo.unknown_cities[:10] %}
        <code style="margin-right: 0.5rem; margin-bottom: 0.5rem; display: inline-block;">{{ name }}</code>
        {% endfor %}
        {% if geo.unknown_cities|length > 10 %}
        <span>... –∏ –µ—â—ë {{ geo.unknown_cities|length - 10 }}</span>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}

