{% extends "base.html" %}

{% block title %}–ü–∞—Ä—Ç–Ω—ë—Ä—ã ‚Äî Borodach Admin{% endblock %}

{% block content %}
<style>
    /* Tags */
    .tag {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        white-space: nowrap;
    }
    .tag-pending {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }
    .tag-verified {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }
    .tag-rejected {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    /* Buttons */
    .btn-delete {
        background: rgba(239, 68, 68, 0.1) !important;
        color: #dc2626 !important;
        border: 1px solid rgba(239, 68, 68, 0.3) !important;
    }
    .btn-delete:hover {
        background: rgba(239, 68, 68, 0.2) !important;
    }
    .btn-edit {
        background: rgba(59, 130, 246, 0.1) !important;
        color: #2563eb !important;
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
    }
    .btn-edit:hover {
        background: rgba(59, 130, 246, 0.2) !important;
    }
    
    /* Table layout */
    .partners-table {
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
    }
    .partners-table th,
    .partners-table td {
        padding: 12px 8px;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
    }
    .partners-table th {
        text-align: left;
        font-weight: 600;
        color: #64748b;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .partners-table tbody tr:hover {
        background: #f8fafc;
    }
    
    /* Column widths */
    .col-id { width: 50px; }
    .col-name { width: 18%; }
    .col-position { width: 10%; }
    .col-phone { width: 12%; }
    .col-telegram { width: 12%; }
    .col-status { width: 10%; text-align: center; }
    .col-shops { width: 18%; }
    .col-date { width: 8%; }
    .col-actions { width: 100px; text-align: center; }
    
    /* Cell content */
    .cell-truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .cell-shops {
        font-size: 0.82rem;
        line-height: 1.4;
    }
    .cell-shops div {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .cell-shops small {
        color: #94a3b8;
    }
    
    /* Position badges */
    .position-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.72rem;
        font-weight: 500;
        white-space: nowrap;
    }
    .position-owner {
        background: rgba(245, 158, 11, 0.15);
        color: #b45309;
    }
    .position-employee {
        background: rgba(107, 114, 128, 0.1);
        color: #4b5563;
    }
    
    /* Actions */
    .actions-cell {
        display: flex;
        gap: 4px;
        justify-content: center;
        flex-wrap: nowrap;
    }
    .actions-cell .btn {
        padding: 4px 8px;
        font-size: 0.85rem;
    }
</style>

<h1 class="mb-2">üë• –ü–∞—Ä—Ç–Ω—ë—Ä—ã</h1>

<div class="card mb-2">
    <div class="flex gap-2">
        <a href="/partners" class="btn {% if not current_status %}btn-primary{% endif %}">–í—Å–µ</a>
        <a href="/partners?status=pending" class="btn {% if current_status == 'pending' %}btn-primary{% endif %}">–û–∂–∏–¥–∞—é—Ç</a>
        <a href="/partners?status=verified" class="btn {% if current_status == 'verified' %}btn-primary{% endif %}">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã</a>
        <a href="/partners?status=rejected" class="btn {% if current_status == 'rejected' %}btn-primary{% endif %}">–û—Ç–∫–ª–æ–Ω–µ–Ω—ã</a>
    </div>
</div>

<div class="card" style="overflow-x: auto;">
    {% if partners %}
    <table class="partners-table">
        <thead>
            <tr>
                <th class="col-id">ID</th>
                <th class="col-name">–§–ò–û</th>
                <th class="col-position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                <th class="col-phone">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th class="col-telegram">Telegram</th>
                <th class="col-status">–°—Ç–∞—Ç—É—Å</th>
                <th class="col-shops">–ë–∞—Ä–±–µ—Ä—à–æ–ø—ã</th>
                <th class="col-date">–î–∞—Ç–∞</th>
                <th class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for partner in partners %}
            <tr>
                <td class="text-muted">{{ partner.id }}</td>
                <td class="cell-truncate" title="{{ partner.full_name }}">{{ partner.full_name }}</td>
                <td>
                    {% if partner.is_owner %}
                    <span class="position-badge position-owner">üî• –í–ª–∞–¥–µ–ª–µ—Ü</span>
                    {% else %}
                    <span class="position-badge position-employee">{{ partner.position or '–°–æ—Ç—Ä—É–¥–Ω–∏–∫' }}</span>
                    {% endif %}
                </td>
                <td class="cell-truncate">{{ partner.phone or '‚Äî' }}</td>
                <td class="cell-truncate" title="@{{ partner.telegram_username }}">@{{ partner.telegram_username or '‚Äî' }}</td>
                <td style="text-align: center;">
                    {% if partner.status.value == 'pending' %}
                    <span class="tag tag-pending">–û–∂–∏–¥–∞–µ—Ç</span>
                    {% elif partner.status.value == 'verified' %}
                    <span class="tag tag-verified">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω</span>
                    {% else %}
                    <span class="tag tag-rejected">–û—Ç–∫–ª–æ–Ω—ë–Ω</span>
                    {% endif %}
                </td>
                <td class="cell-shops">
                    {% if partner.companies %}
                        {% for pc in partner.companies %}
                        <div title="{{ pc.company.name if pc.company else '?' }}">‚Ä¢ {{ pc.company.name if pc.company else '?' }}{% if pc.company and pc.company.city %} <small>({{ pc.company.city }})</small>{% endif %}</div>
                        {% endfor %}
                    {% elif partner.branches %}
                        {% for pb in partner.branches %}
                        <div title="{{ pb.branch.display_name or pb.branch.city }}">‚Ä¢ {{ pb.branch.display_name or pb.branch.city }}</div>
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">‚Äî</span>
                    {% endif %}
                </td>
                <td class="text-muted" style="font-size: 0.85rem;">{{ partner.created_at.strftime('%d.%m.%Y') if partner.created_at else '‚Äî' }}</td>
                <td>
                    <div class="actions-cell">
                        {% if partner.status.value == 'pending' %}
                        <a href="/partners/{{ partner.id }}/verify" class="btn btn-success btn-sm" title="–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å">‚úÖ</a>
                        <form method="post" action="/partners/{{ partner.id }}/reject" style="display: inline; margin: 0;">
                            <input type="hidden" name="reason" value="">
                            <button type="submit" class="btn btn-danger btn-sm" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">‚ùå</button>
                        </form>
                        {% endif %}
                        <a href="/partners/{{ partner.id }}/edit" class="btn btn-sm btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <form method="post" action="/partners/{{ partner.id }}/delete" style="display: inline; margin: 0;"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞ {{ partner.full_name }}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!');">
                            <button type="submit" class="btn btn-sm btn-delete" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted" style="padding: 20px;">–ü–∞—Ä—Ç–Ω—ë—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    {% endif %}
</div>
{% endblock %}

