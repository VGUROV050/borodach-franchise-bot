{% extends "base.html" %}

{% block title %}–ü–∞—Ä—Ç–Ω—ë—Ä—ã ‚Äî Borodach Admin{% endblock %}

{% block content %}
<style>
    .tag {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }
    .tag-pending {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }
    .tag-verified {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }
    .tag-rejected {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }
    .btn-delete {
        background: rgba(239, 68, 68, 0.1) !important;
        color: #dc2626 !important;
        border: 1px solid rgba(239, 68, 68, 0.3) !important;
    }
    .btn-delete:hover {
        background: rgba(239, 68, 68, 0.2) !important;
    }
    .btn-edit {
        background: rgba(59, 130, 246, 0.1) !important;
        color: #2563eb !important;
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
    }
    .btn-edit:hover {
        background: rgba(59, 130, 246, 0.2) !important;
    }
</style>

<h1 class="mb-2">üë• –ü–∞—Ä—Ç–Ω—ë—Ä—ã</h1>

<div class="card mb-2">
    <div class="flex gap-2">
        <a href="/partners" class="btn {% if not current_status %}btn-primary{% endif %}">–í—Å–µ</a>
        <a href="/partners?status=pending" class="btn {% if current_status == 'pending' %}btn-primary{% endif %}">–û–∂–∏–¥–∞—é—Ç</a>
        <a href="/partners?status=verified" class="btn {% if current_status == 'verified' %}btn-primary{% endif %}">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã</a>
        <a href="/partners?status=rejected" class="btn {% if current_status == 'rejected' %}btn-primary{% endif %}">–û—Ç–∫–ª–æ–Ω–µ–Ω—ã</a>
    </div>
</div>

<div class="card">
    {% if partners %}
    <table>
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th>–§–ò–û</th>
                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>Telegram</th>
                <th style="width: 130px; text-align: center;">–°—Ç–∞—Ç—É—Å</th>
                <th style="max-width: 250px;">–ë–∞—Ä–±–µ—Ä—à–æ–ø—ã</th>
                <th style="width: 100px;">–î–∞—Ç–∞</th>
                <th style="width: 130px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for partner in partners %}
            <tr>
                <td>{{ partner.id }}</td>
                <td>{{ partner.full_name }}</td>
                <td style="font-size: 0.85rem;">
                    {% if partner.is_owner %}
                    <span style="color: #d97706;">üëë –í–ª–∞–¥–µ–ª–µ—Ü</span>
                    {% else %}
                    <span style="color: #6b7280;">üë§ {{ partner.position or '–°–æ—Ç—Ä—É–¥–Ω–∏–∫' }}</span>
                    {% endif %}
                </td>
                <td>{{ partner.phone or '‚Äî' }}</td>
                <td>@{{ partner.telegram_username or '‚Äî' }}</td>
                <td style="text-align: center;">
                    {% if partner.status.value == 'pending' %}
                    <span class="tag tag-pending">–û–∂–∏–¥–∞–µ—Ç</span>
                    {% elif partner.status.value == 'verified' %}
                    <span class="tag tag-verified">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω</span>
                    {% else %}
                    <span class="tag tag-rejected">–û—Ç–∫–ª–æ–Ω—ë–Ω</span>
                    {% endif %}
                </td>
                <td style="max-width: 250px; font-size: 0.85rem;">
                    {% if partner.companies %}
                        {% for pc in partner.companies %}
                        <div>‚Ä¢ {{ pc.company.name if pc.company else '?' }}{% if pc.company and pc.company.city %} <small class="text-muted">({{ pc.company.city }})</small>{% endif %}</div>
                        {% endfor %}
                    {% elif partner.branches %}
                        {% for pb in partner.branches %}
                        <div>‚Ä¢ {{ pb.branch.display_name or pb.branch.city }}</div>
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">‚Äî</span>
                    {% endif %}
                </td>
                <td class="text-muted">{{ partner.created_at.strftime('%d.%m.%Y') if partner.created_at else '‚Äî' }}</td>
                <td>
                    <div style="display: flex; gap: 6px; justify-content: center;">
                        {% if partner.status.value == 'pending' %}
                        <a href="/partners/{{ partner.id }}/verify" class="btn btn-success btn-sm" title="–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å">‚úÖ</a>
                        <form method="post" action="/partners/{{ partner.id }}/reject" style="display: inline;">
                            <input type="hidden" name="reason" value="">
                            <button type="submit" class="btn btn-danger btn-sm" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">‚ùå</button>
                        </form>
                        {% endif %}
                        <a href="/partners/{{ partner.id }}/edit" class="btn btn-sm btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <form method="post" action="/partners/{{ partner.id }}/delete" style="display: inline;"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞ {{ partner.full_name }}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!');">
                            <button type="submit" class="btn btn-sm btn-delete" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">–ü–∞—Ä—Ç–Ω—ë—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    {% endif %}
</div>
{% endblock %}

