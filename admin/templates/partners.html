{% extends "base.html" %}

{% block title %}–ü–∞—Ä—Ç–Ω—ë—Ä—ã ‚Äî Borodach Admin{% endblock %}

{% block content %}
<style>
    /* Tags */
    .tag {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.2px;
        white-space: nowrap;
    }
    .tag-pending {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }
    .tag-verified {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }
    .tag-rejected {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    /* Buttons */
    .btn-delete {
        background: rgba(239, 68, 68, 0.1) !important;
        color: #dc2626 !important;
        border: 1px solid rgba(239, 68, 68, 0.3) !important;
    }
    .btn-delete:hover {
        background: rgba(239, 68, 68, 0.2) !important;
    }
    .btn-edit {
        background: rgba(59, 130, 246, 0.1) !important;
        color: #2563eb !important;
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
    }
    .btn-edit:hover {
        background: rgba(59, 130, 246, 0.2) !important;
    }
    
    /* Table layout - –±–µ–∑ fixed, –ø—É—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –ø–æ–¥–±–µ—Ä—ë—Ç —à–∏—Ä–∏–Ω—ã */
    .partners-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
    }
    .partners-table th,
    .partners-table td {
        padding: 10px 12px;
        vertical-align: top;
        border-bottom: 1px solid #f0f0f0;
        text-align: left;
    }
    .partners-table th {
        font-weight: 600;
        color: #64748b;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
        vertical-align: middle;
    }
    .partners-table tbody tr:hover {
        background: #f8fafc;
    }
    
    /* –Ø—á–µ–π–∫–∏ */
    .partners-table td {
        line-height: 1.4;
    }
    
    /* ID - —É–∑–∫–∞—è */
    .col-id { 
        width: 40px;
        color: #94a3b8;
        font-size: 0.8rem;
    }
    
    /* –§–ò–û */
    .cell-name {
        font-weight: 500;
        min-width: 140px;
    }
    
    /* –¢–µ–ª–µ—Ñ–æ–Ω */
    .cell-phone {
        font-size: 0.8rem;
        white-space: nowrap;
        color: #475569;
    }
    
    /* Telegram */
    .cell-telegram {
        font-size: 0.8rem;
        color: #3b82f6;
    }
    
    /* –°—Ç–∞—Ç—É—Å - —Ü–µ–Ω—Ç—Ä */
    .col-status { 
        text-align: center !important;
        white-space: nowrap;
    }
    
    /* –ë–∞—Ä–±–µ—Ä—à–æ–ø—ã - —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å */
    .cell-shops {
        font-size: 0.78rem;
        line-height: 1.5;
        color: #475569;
        min-width: 160px;
        max-width: 220px;
    }
    .cell-shops div {
        margin-bottom: 2px;
    }
    .cell-shops small {
        color: #94a3b8;
        font-size: 0.72rem;
    }
    
    /* –î–∞—Ç–∞ */
    .cell-date {
        font-size: 0.78rem;
        color: #94a3b8;
        white-space: nowrap;
    }
    
    /* –î–µ–π—Å—Ç–≤–∏—è */
    .col-actions {
        text-align: center !important;
        white-space: nowrap;
    }
    .actions-cell {
        display: inline-flex;
        gap: 4px;
        justify-content: center;
    }
    .actions-cell .btn {
        padding: 5px 8px;
        font-size: 0.82rem;
    }
    
    /* Position badges */
    .position-badge {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.68rem;
        font-weight: 500;
        white-space: nowrap;
    }
    .position-owner {
        background: rgba(245, 158, 11, 0.15);
        color: #b45309;
    }
    .position-employee {
        background: rgba(107, 114, 128, 0.1);
        color: #4b5563;
    }
</style>

<h1 class="mb-2">üë• –ü–∞—Ä—Ç–Ω—ë—Ä—ã</h1>

<div class="card mb-2">
    <div class="flex gap-2">
        <a href="/partners" class="btn {% if not current_status %}btn-primary{% endif %}">–í—Å–µ</a>
        <a href="/partners?status=pending" class="btn {% if current_status == 'pending' %}btn-primary{% endif %}">–û–∂–∏–¥–∞—é—Ç</a>
        <a href="/partners?status=verified" class="btn {% if current_status == 'verified' %}btn-primary{% endif %}">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã</a>
        <a href="/partners?status=rejected" class="btn {% if current_status == 'rejected' %}btn-primary{% endif %}">–û—Ç–∫–ª–æ–Ω–µ–Ω—ã</a>
    </div>
</div>

<div class="card" style="overflow-x: auto;">
    {% if partners %}
    <table class="partners-table">
        <thead>
            <tr>
                <th class="col-id">ID</th>
                <th>–§–ò–û</th>
                <th>–†–æ–ª—å</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>Telegram</th>
                <th class="col-status">–°—Ç–∞—Ç—É—Å</th>
                <th>–ë–∞—Ä–±–µ—Ä—à–æ–ø—ã</th>
                <th>–î–∞—Ç–∞</th>
                <th class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for partner in partners %}
            <tr>
                <td class="col-id">{{ partner.id }}</td>
                <td class="cell-name">{{ partner.full_name }}</td>
                <td>
                    {% if partner.is_owner %}
                    <span class="position-badge position-owner">üî• –í–ª–∞–¥–µ–ª–µ—Ü</span>
                    {% else %}
                    <span class="position-badge position-employee">{{ partner.position or '–°–æ—Ç—Ä—É–¥–Ω–∏–∫' }}</span>
                    {% endif %}
                </td>
                <td class="cell-phone">{{ partner.phone or '‚Äî' }}</td>
                <td class="cell-telegram">@{{ partner.telegram_username or '‚Äî' }}</td>
                <td class="col-status">
                    {% if partner.status.value == 'pending' %}
                    <span class="tag tag-pending">–û–∂–∏–¥–∞–µ—Ç</span>
                    {% elif partner.status.value == 'verified' %}
                    <span class="tag tag-verified">‚úì</span>
                    {% else %}
                    <span class="tag tag-rejected">‚úó</span>
                    {% endif %}
                </td>
                <td class="cell-shops">
                    {% if partner.companies %}
                        {% for pc in partner.companies %}
                        <div>{{ pc.company.name if pc.company else '?' }}{% if pc.company and pc.company.city %}<br><small>{{ pc.company.city }}</small>{% endif %}</div>
                        {% endfor %}
                    {% elif partner.branches %}
                        {% for pb in partner.branches %}
                        <div>{{ pb.branch.display_name or pb.branch.city }}</div>
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">‚Äî</span>
                    {% endif %}
                </td>
                <td class="cell-date">{{ partner.created_at.strftime('%d.%m.%Y') if partner.created_at else '‚Äî' }}</td>
                <td class="col-actions">
                    <div class="actions-cell">
                        {% if partner.status.value == 'pending' %}
                        <a href="/partners/{{ partner.id }}/verify" class="btn btn-success btn-sm" title="–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å">‚úÖ</a>
                        <form method="post" action="/partners/{{ partner.id }}/reject" style="display: inline; margin: 0;">
                            <input type="hidden" name="reason" value="">
                            <button type="submit" class="btn btn-danger btn-sm" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">‚ùå</button>
                        </form>
                        {% endif %}
                        <a href="/partners/{{ partner.id }}/edit" class="btn btn-sm btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <form method="post" action="/partners/{{ partner.id }}/delete" style="display: inline; margin: 0;"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞ {{ partner.full_name }}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!');">
                            <button type="submit" class="btn btn-sm btn-delete" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted" style="padding: 20px;">–ü–∞—Ä—Ç–Ω—ë—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    {% endif %}
</div>
{% endblock %}

