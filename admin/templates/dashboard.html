{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî Borodach Admin{% endblock %}

{% block content %}
<h1 class="mb-2">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ pending_count }}</div>
        <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ pending_branches_count|default(0) }}</div>
        <div class="stat-label">–ó–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ñ–∏–ª–∏–∞–ª—ã</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ verified_partners|length }}</div>
        <div class="stat-label">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ)</div>
    </div>
</div>

{% if pending_partners %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">‚è≥ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é</h2>
        <span class="badge badge-pending">{{ pending_count }}</span>
    </div>
    
    {% for partner in pending_partners %}
    <div class="partner-card">
        <div class="flex" style="justify-content: space-between; align-items: start;">
            <div>
                <div class="partner-name">{{ partner.full_name }}</div>
                <div class="partner-info">
                    üì± {{ partner.phone or '‚Äî' }}<br>
                    üí¨ @{{ partner.telegram_username or '‚Äî' }} (ID: {{ partner.telegram_id }})
                </div>
                
                {% if partner.branches_text %}
                <div class="partner-branches">
                    <strong>üè¢ –§–∏–ª–∏–∞–ª—ã (—Ç–µ–∫—Å—Ç):</strong><br>
                    <pre>{{ partner.branches_text }}</pre>
                </div>
                {% endif %}
            </div>
            
            <span class="text-muted" style="font-size: 0.8rem;">
                {{ partner.created_at.strftime('%d.%m.%Y %H:%M') if partner.created_at else '' }}
            </span>
        </div>
        
        <div class="partner-actions">
            <a href="/partners/{{ partner.id }}/verify" class="btn btn-success btn-sm">‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å</a>
            
            <form method="post" action="/partners/{{ partner.id }}/reject" style="display: inline;">
                <input type="hidden" name="reason" value="">
                <button type="submit" class="btn btn-danger btn-sm">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <p class="text-muted">‚úÖ –ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é</p>
</div>
{% endif %}

{% if pending_branches %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">üè¢ –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–æ–≤</h2>
        <span class="badge badge-warning">{{ pending_branches_count }}</span>
    </div>
    
    {% for partner in pending_branches %}
    <div class="partner-card">
        <div class="flex" style="justify-content: space-between; align-items: start;">
            <div>
                <div class="partner-name">{{ partner.full_name }}</div>
                <div class="partner-info">
                    üì± {{ partner.phone or '‚Äî' }}<br>
                    üí¨ @{{ partner.telegram_username or '‚Äî' }}
                </div>
                
                <div class="partner-branches">
                    <strong>üè¢ –¢–µ–∫—É—â–∏–µ —Ñ–∏–ª–∏–∞–ª—ã:</strong><br>
                    {% if partner.branches %}
                        {% for pb in partner.branches %}
                            ‚Ä¢ {{ pb.branch.display_name or pb.branch.city }}<br>
                        {% endfor %}
                    {% else %}
                        <em>–ù–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤</em>
                    {% endif %}
                </div>
                
                {% if partner.branches_text %}
                <div class="partner-branches" style="margin-top: 0.5rem; background: #fff3cd; padding: 0.5rem; border-radius: 4px;">
                    <strong>üìù –ó–∞–ø—Ä–æ—Å –Ω–∞ –Ω–æ–≤—ã–π –±–∞—Ä–±–µ—Ä—à–æ–ø:</strong><br>
                    <pre style="margin: 0; white-space: pre-wrap;">{{ partner.branches_text }}</pre>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="partner-actions">
            <a href="/partners/{{ partner.id }}/add-barbershop" class="btn btn-success btn-sm">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –±–∞—Ä–±–µ—Ä—à–æ–ø</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if verified_partners %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</h2>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>–ü–∞—Ä—Ç–Ω—ë—Ä</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>Telegram</th>
                <th>–î–∞—Ç–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for partner in verified_partners %}
            <tr>
                <td>{{ partner.full_name }}</td>
                <td>{{ partner.phone or '‚Äî' }}</td>
                <td>@{{ partner.telegram_username or '‚Äî' }}</td>
                <td class="text-muted">{{ partner.verified_at.strftime('%d.%m.%Y') if partner.verified_at else '‚Äî' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}

