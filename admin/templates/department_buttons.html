{% extends "base.html" %}

{% block title %}–ü–æ–ª–µ–∑–Ω–æ–µ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">üìö –ü–æ–ª–µ–∑–Ω–æ–µ ‚Äî –ö–Ω–æ–ø–∫–∏ –æ—Ç–¥–µ–ª–æ–≤</h1>
    <a href="/useful-info/buttons/create" class="btn btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É</a>
</div>

<p style="color: var(--text-muted); margin-bottom: 1.5rem;">
    –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–ü–æ–ª–µ–∑–Ω–æ–µ" –≤ –±–æ—Ç–µ. –ö–Ω–æ–ø–∫–∞ "‚óÄÔ∏è –ù–∞–∑–∞–¥" –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
</p>

<div class="departments-grid">
{% for dept in DepartmentType %}
<div class="card department-card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="card-title">
            {% if dept.value == 'development' %}üöÄ –û—Ç–¥–µ–ª –†–∞–∑–≤–∏—Ç–∏—è
            {% elif dept.value == 'marketing' %}üì¢ –û—Ç–¥–µ–ª –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞
            {% elif dept.value == 'design' %}üé® –û—Ç–¥–µ–ª –î–∏–∑–∞–π–Ω–∞
            {% endif %}
        </div>
        <a href="/useful-info/buttons/create?department={{ dept.value }}" class="btn btn-sm btn-add">
            + –ö–Ω–æ–ø–∫–∞
        </a>
    </div>
    
    <div class="buttons-list">
        {% if grouped[dept] %}
            {% for button in grouped[dept] %}
            <div class="button-item{% if not button.is_active %} inactive{% endif %}">
                <div class="button-main">
                    <div class="button-order">{{ button.order }}</div>
                    <div class="button-content">
                        <div class="button-text">{{ button.button_text }}</div>
                        <div class="button-preview">
                            <div class="telegram-bubble-mini">
                                {{ button.message_text[:100] }}{% if button.message_text|length > 100 %}...{% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="button-actions">
                        {% if button.is_active %}
                        <span class="status-dot active" title="–ê–∫—Ç–∏–≤–Ω–∞"></span>
                        {% else %}
                        <span class="status-dot" title="–í—ã–∫–ª—é—á–µ–Ω–∞"></span>
                        {% endif %}
                        <a href="/useful-info/buttons/{{ button.id }}/edit" class="btn-icon" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <form action="/useful-info/buttons/{{ button.id }}/toggle" method="post" style="display: inline;">
                            <button type="submit" class="btn-icon" title="{% if button.is_active %}–í—ã–∫–ª—é—á–∏—Ç—å{% else %}–í–∫–ª—é—á–∏—Ç—å{% endif %}">
                                {% if button.is_active %}üëÅÔ∏è{% else %}üëÅÔ∏è‚Äçüó®Ô∏è{% endif %}
                            </button>
                        </form>
                        <form action="/useful-info/buttons/{{ button.id }}/delete" method="post" style="display: inline;"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´{{ button.button_text }}¬ª?');">
                            <button type="submit" class="btn-icon btn-danger" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>–ö–Ω–æ–ø–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                <a href="/useful-info/buttons/create?department={{ dept.value }}" class="btn btn-sm">
                    –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é
                </a>
            </div>
        {% endif %}
    </div>
    
    <!-- –ü—Ä–µ–≤—å—é –∫–∞–∫ –≤ –±–æ—Ç–µ -->
    <div class="bot-preview">
        <div class="preview-title">–ü—Ä–µ–≤—å—é –≤ –±–æ—Ç–µ:</div>
        <div class="preview-buttons">
            {% for button in grouped[dept] %}
                {% if button.is_active %}
                <div class="preview-btn">{{ button.button_text }}</div>
                {% endif %}
            {% endfor %}
            <div class="preview-btn preview-btn-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</div>
        </div>
    </div>
</div>
{% endfor %}
</div>

<style>
.departments-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 1.5rem;
}

.department-card {
    display: flex;
    flex-direction: column;
}

.btn-add {
    background: var(--primary);
    color: white;
    padding: 0.25rem 0.75rem;
    font-size: 0.8rem;
}

.buttons-list {
    padding: 1rem;
    flex: 1;
}

.button-item {
    background: var(--bg-main);
    border-radius: 10px;
    padding: 0.75rem;
    margin-bottom: 0.75rem;
}

.button-item:last-child {
    margin-bottom: 0;
}

.button-item.inactive {
    opacity: 0.5;
}

.button-main {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

.button-order {
    background: var(--primary);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    flex-shrink: 0;
}

.button-content {
    flex: 1;
    min-width: 0;
}

.button-text {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.button-preview {
    font-size: 0.8rem;
}

.telegram-bubble-mini {
    background: linear-gradient(135deg, #e3f0ff 0%, #d4e8ff 100%);
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    color: #333;
    font-size: 0.75rem;
    line-height: 1.4;
    max-height: 60px;
    overflow: hidden;
}

.button-actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    flex-shrink: 0;
}

.btn-icon {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    font-size: 1rem;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.btn-icon:hover {
    opacity: 1;
}

.btn-icon.btn-danger:hover {
    filter: saturate(2);
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
    margin-right: 0.25rem;
}

.status-dot.active {
    background: var(--success);
}

.empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-muted);
}

.empty-state p {
    margin-bottom: 1rem;
}

/* Bot preview */
.bot-preview {
    border-top: 1px solid var(--border);
    padding: 1rem;
    background: #e5ddd5;
    border-radius: 0 0 12px 12px;
}

.preview-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    color: #666;
    margin-bottom: 0.5rem;
    letter-spacing: 0.5px;
}

.preview-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.preview-btn {
    background: #fff;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    text-align: center;
    font-size: 0.85rem;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.preview-btn-back {
    background: #f0f0f0;
    color: #666;
}
</style>
{% endblock %}
